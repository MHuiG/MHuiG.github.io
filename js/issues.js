function parseIssuesData(e,n){var s=new Object;if(0<n.length)for(i=0;i<n.length;i++){var t=n[i].body.match(/group:[^\n]*\n/);if(t&&0<t.length&&(t=t[0].replace(/(group:[\s]*|[\r\n]*)/g,"").split(", ")),t)for(var a=0;a<t.length;a++){var r,l=t[a];l in s?s[l].push(n[i]):((r=new Array).push(n[i]),s[l]=r)}else{var o=s[""];null==o&&(o=new Array),o.push(n[i]),s[""]=o}}return s}function getIssuesAPIForSites(h){var f=$(h.el)[0];$(f).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>正在加载</p></div>');var r=10;!function a(){return new Promise(function(n,e){var s=0,t=setTimeout(function(){0===s&&(s=2,t=null,e("超时"),0==r&&($(f).find(".loading i").remove(),$(f).find(".loading p").text("加载失败，请稍后重试。")))},5e3);fetch(h.api).then(function(e){if(2!==s&&(clearTimeout(t),n(e),t=null,s=1),e.ok)return e.json();throw new Error("Network response was not ok.")}).then(function(e){$(f).find(".loading").remove();var n=parseIssuesData(h,e);for(null==h.group&&(h.group=Object.keys(n)),i=0;i<h.group.length;i++){var s=h.group[i];if(!(0<s.length&&null==n[s])){var t=n[s];for(0<s.length?$(f).append("<h2>"+s+"</h2>"):""==s&&1<h.group.length&&$(f).append("<h2>未分组</h2>"),$(f).append('<div class="site-card-group '+i+'"></div>'),j=0;j<t.length;j++){var a=t[j],r=a.body.match(/title:[^\n]*\n/);r&&0<r.length&&(r=r[0].replace(/(title:[\s]*|[\r\n]*)/g,""));var l=a.body.match(/screenshot:[^\n]*\n/);l&&0<l.length&&(l=l[0].replace(/(screenshot:[\s]*|[\r\n]*)/g,""));var o=a.body.match(/avatar:[^\n]*\n/);o&&0<o.length&&(o=o[0].replace(/(avatar:[\s]*|[\r\n]*)/g,""));var c=a.body.match(/description:[^\n]*\n/);c&&0<c.length&&(c=c[0].replace(/(description:[\s]*|[\r\n]*)/g,""));var p=a.body.match(/url:[^\n]*\n/);p&&0<p.length&&(p=p[0].replace(/(url:[\s]*|[\r\n]*)/g,""));var d=a.body.match(/keywords:[^\n]*\n/);d&&0<d.length&&(d=(d=d[0].replace(/(keywords:[\s]*|[\r\n]*)/g,"")).replace("[","").replace("]","").split(", "));var g=l&&0<l.length?'<div class="img"><img src="'+l+'" onerror="javascript:this.src=\'https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg\';"/></div>':'<div class="img"></div>',u='<div class="info">';o&&0<o.length&&(u+='<img src="'+o+'" onerror="javascript:this.src=\'https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg\';"/>');var v="<a class='site-card' target='_blank' href='"+p+"'>"+g+(u+='<span class="title">'+r+'</span><span class="desc">'+(c||d&&d.join("、"))+"</span></div>")+"</a>";$(f).find(".site-card-group."+i).append(v)}}}}).catch(function(e){0<r?(--r,$(f).find(".loading p").text("加载失败，正在重试..."),setTimeout(function(){a()},5e3)):($(f).find(".loading i").remove(),$(f).find(".loading p").text("加载失败，请稍后重试。"))})})}()}function getIssuesAPIForTimeline(e){var a=$(e.el)[0];$(a).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>正在加载</p></div>'),$.get(e.api,function(e,n){if($(a).find(".loading").remove(),0<e.length)for(i=0;i<e.length;i++){var s='&nbsp;&nbsp;<a class="comments" target="_blank" href="'+e[i].html_url+'"><i class="fa fa-comment-dots fa-fw"></i>'+e[i].comments+"</a>",t='<div class="timenode"><div class="meta"><p></p><p>'+e[i].title+s+'</p><p></p></div><div class="body"><p>'+e[i].body+"</p></div></div>";$(a).append(t)}})}function checkIssues(){for(var e=document.getElementsByClassName("issues-api"),n=0;n<e.length;n++){var i=e[n],s=i.getAttribute("api"),t=i.getAttribute("group"),a=new Object;a.class=i.getAttribute("class"),a.el=i,a.api=s,a.group=t?t.replace(/(,[\s]*)/g,",").split(","):void 0,a.class.split(" ").includes("sites")?getIssuesAPIForSites(a):a.class.split(" ").includes("timeline")&&getIssuesAPIForTimeline(a)}}document.addEventListener("DOMContentLoaded",function(){checkIssues()}),document.addEventListener("pjax:complete",function(){checkIssues()});