<!DOCTYPE html><html><head hexo-theme="https://github.com/volantis-x/hexo-theme-volantis/tree/4.0.0-rc.1"><meta charset="utf-8"><meta name="renderer" content="webkit"><meta name="force-rendering" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>初探 Cloudflare Workers 边缘计算 - MHuiG</title><meta name="keywords" content="边缘计算"><meta name="description" content="尝试在边缘运行JavaScript。"><link rel="alternate" href="/atom.xml" title="MHuiG" type="application/atom+xml"><meta name="theme-color" content="skyblue"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="shortcut icon" type="image/x-icon" sizes="16x16 32x32 48x48 64x64" href="https://cdn.jsdelivr.net/npm/mhg@0.0.0/favicon/favicon.ico"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://cdn.jsdelivr.net/npm/mhg@0.0.0/favicon/favicon_180.png"><link rel="mask-icon" color="#1BC3FB" href="https://cdn.jsdelivr.net/npm/mhg@0.0.0/favicon/favicon_180.png"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><link rel="dns-prefetch" href="https://rmt.dogedoge.com"><link rel="dns-prefetch" href="https://mv.mhuig.top"><link rel="dns-prefetch" href="https://zz.bdstatic.com"><link rel="dns-prefetch" href="https://push.zhanzhang.baidu.com"><link rel="dns-prefetch" href="https://github.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mhg@0.0.8/css/style.css"><script>setTimeout(function(){window.ga_tid="UA-148909894-1",function(){var e=document.createElement("script");e.src="https://rmt.dogedoge.com/fetch/public/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()},5e3);</script><script>var _hmt=_hmt||[];setTimeout(function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?d367964cbb21775bfbb9c16fe4da3484",e.defer=!0;var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},5e3);</script><script id="loadcss"></script><script>function loadScript(o,t){var i=document.createElement("script");i.src=o,t&&(i.onload=t),i.async=!0,document.body.appendChild(i)}"mhuig.github.io"!=window.location.host&&"localhost:4000"!=window.location.host&&"blog.mhuig.top"!=window.location.host&&"dev.mhuig.top"!=window.location.host&&"me.mhuig.top"!=window.location.host&&"coding.mhuig.top"!=window.location.host&&(window.location.host="blog.mhuig.top:443");</script></head><body><header class="l_header auto shadow floatable blur" style="opacity:0"><div class="container"><div class="wrapper"><div class="nav-sub"><p class="title"></p><ul class="switcher nav-list-h m-phone" id="pjax-header-nav-list"><li><a class="s-comment fad fa-comments fa-fw" target="_self" href="javascript:void(0)"></a></li></ul></div><div class="nav-main"> <a class="title flat-box" target="_self" href="/">MHuiG's Blog</a><div class="menu navigation"><ul class="nav-list-h m-pc"><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fad fa-list-alt fa-fw"></i> 索引</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fad fa-folder-open fa-fw"></i> 分类</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fad fa-tags fa-fw"></i> 标签</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fad fa-archive fa-fw"></i> 归档</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fad fa-link fa-fw"></i> 友链</a><ul class="list-v"><li class="header"><i class="fad fa-share fa-fw"></i> 友链接力</li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://travellings.now.sh/" id="https:travellingsnowsh" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-paper-plane fa-fw"></i> Travelling</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fad fa-user-tie fa-fw"></i> 关于</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/time-machine/" id="time-machine"><i class="fad fa-clock fa-fw"></i> 时光机</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-fan fa-spin fa-fw"></i> 更多</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-user-shield fa-fw"></i> 博客管理</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="https://info.mhuig.top" id="https:infomhuigtop" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-comments fa-fw"></i> 评论管理</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://www.yuque.com/mhuig" id="https:wwwyuquecommhuig" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-edit fa-fw"></i> 云端编辑</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://status.mhuig.top/" id="https:statusmhuigtop" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-telescope fa-fw"></i> Monitors</a></li></ul></li><hr><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-tools fa-fw"></i> 工具箱</a><ul class="list-v"><li class="header"><i class="fad fa-moon darkbtn fa-fw"></i> Dark Mode</li><li><a class="menuitem flat-box"><i class="fad fa-compact-disc fa-spin fa-fw music"></i> Music</a><ul class="list-v"><li><div class="aplayer-container"><meting-js theme="#1BCDFC" volume="0.7" loop="all" order="list" fixed="false" list-max-height="320px" server="netease" type="song" id="412785957" list-folded="true"></meting-js></div></li></ul></li><li></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://MHuiG.github.io/NoteBook/" id="https:MHuiGgithubioNoteBook"><i class="fad fa-star fa-spin fa-fw"></i> NoteBook</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/atom.xml" id="atomxml"><i class="fad fa-rss fa-fw"></i> RSS订阅</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/sitemap.xml" id="sitemapxml"><i class="fad fa-sitemap fa-fw"></i> 站点地图</a></li></ul></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="https://github.com/MHuiG" id="https:githubcomMHuiG" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></li></ul></li></ul></div><div class="m_search"><form name="searchform" class="form u-search-form"><i class="icon fad fa-search fa-fw"></i> <input type="text" class="input u-search-input" placeholder="Search..."></form></div><ul class="switcher nav-list-h m-phone"><li><a class="s-search fad fa-search fa-fw" target="_self" href="javascript:void(0)"></a></li><li><a class="s-menu fad fa-bars fa-fw" target="_self" href="javascript:void(0)"></a><ul class="menu-phone list-v navigation white-box"><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fad fa-list-alt fa-fw"></i> 索引</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/categories/" id="categories"><i class="fad fa-folder-open fa-fw"></i> 分类</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/tags/" id="tags"><i class="fad fa-tags fa-fw"></i> 标签</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/archives/" id="archives"><i class="fad fa-archive fa-fw"></i> 归档</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/friends/" id="friends"><i class="fad fa-link fa-fw"></i> 友链</a><ul class="list-v"><li class="header"><i class="fad fa-share fa-fw"></i> 友链接力</li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://travellings.now.sh/" id="https:travellingsnowsh" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-paper-plane fa-fw"></i> Travelling</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/about/" id="about"><i class="fad fa-user-tie fa-fw"></i> 关于</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="/time-machine/" id="time-machine"><i class="fad fa-clock fa-fw"></i> 时光机</a></li></ul></li><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-fan fa-spin fa-fw"></i> 更多</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-user-shield fa-fw"></i> 博客管理</a><ul class="list-v"><li><a class="menuitem flat-box faa-parent animated-hover" href="https://info.mhuig.top" id="https:infomhuigtop" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-comments fa-fw"></i> 评论管理</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://www.yuque.com/mhuig" id="https:wwwyuquecommhuig" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-edit fa-fw"></i> 云端编辑</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://status.mhuig.top/" id="https:statusmhuigtop" rel="external nofollow noopener noreferrer" target="_blank"><i class="fad fa-telescope fa-fw"></i> Monitors</a></li></ul></li><hr><li><a class="menuitem flat-box faa-parent animated-hover"><i class="fad fa-tools fa-fw"></i> 工具箱</a><ul class="list-v"><li class="header"><i class="fad fa-moon darkbtn fa-fw"></i> Dark Mode</li><li><a class="menuitem flat-box faa-parent animated-hover" href="https://MHuiG.github.io/NoteBook/" id="https:MHuiGgithubioNoteBook"><i class="fad fa-star fa-spin fa-fw"></i> NoteBook</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/atom.xml" id="atomxml"><i class="fad fa-rss fa-fw"></i> RSS订阅</a></li><li><a class="menuitem flat-box faa-parent animated-hover" href="/sitemap.xml" id="sitemapxml"><i class="fad fa-sitemap fa-fw"></i> 站点地图</a></li></ul></li><hr><li><a class="menuitem flat-box faa-parent animated-hover" href="https://github.com/MHuiG" id="https:githubcomMHuiG" rel="external nofollow noopener noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i> GitHub</a></li></ul></li></ul></li></ul></div></div></div></header><div class="l_body"><div class="l_cover"><div class="cover-wrapper post featured" style="display:none"><div class="cover-backstretch"></div><div class="cover-body"><div class="top"><p class="title">MHuiG</p><p class="subtitle">「Be Yourself, Make a Difference.」</p></div><div class="bottom"><div class="menu navigation"><div class="list-h"><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/MHuiG" id="https:githubcomMHuiG"><i class="fab fa-github fa-fw" style="color:#000"></i><p>Github</p></a><a href="/friends/" id="friends"><i class="fad fa-link fa-fw" style="color:#d31ee9"></i><p>友链</p></a><a href="/about/" id="about"><i class="fad fa-user-tie fa-fw" style="color:#0095ff"></i><p>关于</p></a><a target="_blank" rel="external nofollow noopener noreferrer" href="https://travellings.now.sh/" id="https:travellingsnowsh"><i class="fad fa-paper-plane fa-fw" style="color:#734ae6"></i><p>Travelling</p></a></div></div></div></div><div class="scroll-down" style="display:none"><i class="fa fa-chevron-down scroll-down-effects"></i></div></div></div><div class="safearea"><div class="body-wrapper" id="pjax-container"><div id="pjax-data" style="display:none"><div id="pjax-ispage">true</div><div id="pjax-pageTitle">初探 Cloudflare Workers 边缘计算</div><div id="pjax-enable-cover">true</div><div id="pjax-comment-path"></div><div id="pjax-comment-placeholder"></div></div><script>document.getElementsByClassName("cover-wrapper")[0].style.display="none",document.getElementsByClassName("l_header","cover-wrapper")[0].classList.add("show");</script><div class="l_main no_sidebar"><article class="article post white-box reveal md shadow floatable blur article-type-post" id="post" itemscope itemprop="blogPost"><div class="article-header"><div class="article-meta" id="top"><h1 class="title"> <a href="/posts/4a0f523a.html">初探 Cloudflare Workers 边缘计算</a></h1><div class="new-meta-box"><div class="new-meta-item category"><a class="notlink"><i class="fad fa-folder-open fa-fw" aria-hidden="true"></i> <a class="category-link" href="/categories/%E8%BE%B9%E7%BC%98%E8%AE%A1%E7%AE%97/">边缘计算</a></a></div><div class="new-meta-item date"><a class="notlink"><i class="fad fa-calendar-alt fa-fw" aria-hidden="true"></i><p>发布于：2020年8月31日</p></a></div><div class="new-meta-item wordcount"><a class="notlink"><i class="fad fa-keyboard fa-fw" aria-hidden="true"></i><p>字数：2.3k字</p></a></div><div class="new-meta-item readtime"><a class="notlink"><i class="fad fa-hourglass-half fa-fw" aria-hidden="true"></i><p>时长：10分钟</p></a></div></div></div></div><div class="article-entry" itemprop="articleBody"> <span class="p center logo large">Edge Computing</span> <span class="p center small">尝试在边缘运行 JavaScript</span><h2 id="什么是边缘计算"><a href="#什么是边缘计算" class="headerlink" title="什么是边缘计算"></a>什么是边缘计算</h2><p><strong>边缘运算</strong>（Edge computing），又译为<strong>边缘计算</strong>，是一种分散式运算的架构，将应用程序、数据资料与服务的运算，由网络中心节点，移往网络逻辑上的边缘节点来处理。边缘计算将原本完全由中心节点处理大型服务加以分解，切割成更小与更容易管理的部分，分散到边缘节点去处理。边缘节点更接近于用户终端装置，可以加快资料的处理与传送速度，减少延迟。在这种架构下，资料的分析与知识的产生，更接近于数据资料的来源，因此更适合处理大数据。</p><p>OpenStack（是一个由NASA和Rackspace合作研发并发起的，以Apache许可证授权的自由软件和开放源代码项目）社区的定义概念：</p><p>“<em>边缘计算是为应用开发者和服务提供商在网络的边缘侧提供云服务和IT环境服务；目标是在靠近数据输入或用户的地方提供计算、存储和网络带宽”。</em></p><h2 id="章鱼理论秒懂边缘计算"><a href="#章鱼理论秒懂边缘计算" class="headerlink" title="章鱼理论秒懂边缘计算"></a>章鱼理论秒懂边缘计算</h2><p><strong>章鱼理论：用 “ 脚 “ 解决问题的边缘计算！</strong></p><p>作为无脊椎动物中智商最高的一种动物，章鱼拥有巨量的神经元，但60%分布在章鱼的八条腿（腕足）上，脑部仅有40%。</p><p>也就是说：</p><p><img src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194222.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194222.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p><img src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194251.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194251.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><div class="note warning"><p>警告：本文从以下开始跑题。</p></div><details><summary><p>== 需要M03-GLORIA程序特殊访问权限 ==</p></summary><div class="content"><p>正在读取资料。请稍等…….</p><p><span class="p red">[拒绝访问]</span><br><span class="p red">[该数据已被删除]</span></p><p>正在读取备份。请稍等…….</p><h2 id="本博客边缘计算的搭建方案"><a href="#本博客边缘计算的搭建方案" class="headerlink" title="本博客边缘计算的搭建方案"></a>本博客边缘计算的搭建方案</h2><p>本博客目前采用Vercel、Cloudflare、GithubPages多线部署，未来可能会考虑添加██████等其他线路。笔者在此解释一下Cloudflare线路的边缘计算部署方案。</p><p>正如你所见，静态页面托管存储在Github仓库██████中，并开启<a target="_blank" rel="external nofollow noopener noreferrer" href="https://pages.github.com/">GitHub Pages</a>服务，使用<a target="_blank" rel="external nofollow noopener noreferrer" href="https://workers.cloudflare.com/">Cloudflare Workers</a>实现边缘计算处理逻辑，<a target="_blank" rel="external nofollow noopener noreferrer" href="https://leancloud.app/">LearnCloud</a>数据库存储网站动态数据。</p><p>笔者在这里只谈部署思路，由于███████████████████████████████████，我相信应该不会有人愿意开源公开自己的后端程序，安全策略以及██████████████████████等等。</p><h3 id="实现网站镜像"><a href="#实现网站镜像" class="headerlink" title="实现网站镜像"></a>实现网站镜像</h3><p>目前Cloudflare线路即为GithubPages的镜像站，<psw>我不说相信你也可以看出来</psw>，当然我也可以随时切换为Vercel或者██████或者██████的镜像站。</p><p>在网络边缘拦截用户请求，并修改请求中的<code>request.url.hostname</code>,将对用户请求的域解析替换为原始真实URL，实现隐藏真实网络基础设施的目的。</p><p>具体实现可以查阅<a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.cloudflare.com/workers/examples/bulk-origin-proxy">相关文档</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * An object with different URLs to fetch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> <span class="variable">ORIGINS</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> ORIGINS = &#123;</span><br><span class="line">  <span class="string">&quot;starwarsapi.yourdomain.com&quot;</span>: <span class="string">&quot;swapi.co&quot;</span>,</span><br><span class="line">  <span class="string">&quot;google.yourdomain.com&quot;</span>: <span class="string">&quot;google.com&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">handleRequest</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> url = <span class="keyword">new</span> URL(request.url)</span><br><span class="line">  <span class="comment">// Check if incoming hostname is a key in the ORIGINS object</span></span><br><span class="line">  <span class="keyword">if</span> (url.hostname <span class="keyword">in</span> ORIGINS) &#123;</span><br><span class="line">    <span class="keyword">const</span> target = ORIGINS[url.hostname]</span><br><span class="line">    url.hostname = target</span><br><span class="line">    <span class="comment">// If it is, proxy request to that third party origin</span></span><br><span class="line">    <span class="keyword">return</span> fetch(url.toString(), request)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Otherwise, process request as normal</span></span><br><span class="line">  <span class="keyword">return</span> fetch(request)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">addEventListener(<span class="string">&quot;fetch&quot;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  event.respondWith(handleRequest(event.request))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="隐藏前端API密钥"><a href="#隐藏前端API密钥" class="headerlink" title="隐藏前端API密钥"></a>隐藏前端API密钥</h3><p>由于调用数据库API需要使用<strong>AppID</strong>和<strong>AppKey</strong>：</p><p><img src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194318.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194318.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>而直接将他们写在前端页面存在安全风险，因此笔者将数据库API密钥直接写在了Cloudflare Worker中。</p><p>以本站的评论系统为例，在前端页面插入伪造的API密钥以作混淆，<psw>下图一看就知道是伪造的密钥</psw>。</p><p><img src="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194331.png" class="lazyload" data-srcset="https://cdn.jsdelivr.net/gh/MHuiG/imgbed/data/2020831194331.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII="></p><p>在网络边缘拦截用户请求，判断请求合法性，动态更改请求标头替换为真实的API密钥，并向后端数据库转发请求，实现数据交互时隐藏API密钥。</p><p>具体实现可以查阅<a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.cloudflare.com/workers/runtime-apis/request">相关文档</a></p><h3 id="获取访问者IP-地理位置信息"><a href="#获取访问者IP-地理位置信息" class="headerlink" title="获取访问者IP 地理位置信息"></a>获取访问者IP 地理位置信息</h3><p>从 CF-IPCountry HTTP 标头检索 IP 地理位置信息，以判断访问者合法性██████████████████，对于非法访问者████████████████████████████。</p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://support.cloudflare.com/hc/en-us/articles/200170986-How-does-Cloudflare-handle-HTTP-Request-headers-">How does Cloudflare handle HTTP Request headers?</a></p><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://support.cloudflare.com/hc/en-us/articles/200168236-Configuring-Cloudflare-IP-Geolocation">Configuring Cloudflare IP Geolocation</a></p><h3 id="记录请求日志"><a href="#记录请求日志" class="headerlink" title="记录请求日志"></a>记录请求日志</h3><p>由于Cloudflare Workers没有导入依赖包的功能██████████████████，因此笔者使用Leancloud数据库的<a target="_blank" rel="external nofollow noopener noreferrer" href="https://leancloud.cn/docs/rest_api.html">REST API</a>发送 HTTP 请求来与 <strong>数据库</strong> 进行交互。</p><p>Cloudflare Workers默认在事件的<code>response</code>发送完成后结束边缘的相关进程，<a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.cloudflare.com/workers/runtime-apis/fetch-event#methods">这里</a>笔者使用<code>event.waitUntil(promise Promise)</code>,延长事件的生存期，而不会阻止事件的<code>response</code>发送。使用此方法可以通知运行时以等待需要比正常的发送响应时间更长的时间运行的任务（例如，日志记录，对第三方服务的分析，流和缓存）。</p><p>将所有请求记录到数据库中，以便需要时调查取证或者█████████。</p><h3 id="HTTP2-server-push"><a href="#HTTP2-server-push" class="headerlink" title="HTTP2 server push"></a>HTTP2 server push</h3><p>多路复用，是HTTP/2众多协议优化中最令人振奋的特性，它大大降低了网络延迟对性能的影响，而对于资源之间的依赖关系导致的“延迟”，Server Push则提供了手动优化方案。</p><p>通常，只有在浏览器请求某个资源的时候，服务器才会向浏览器发送该资源。Server Push则允许服务器在收到浏览器的请求之前，主动向浏览器推送资源。比如说，网站首页引用了一个CSS文件。浏览器在请求首页时，服务器除了返回首页的HTML之外，可以将其引用的 CSS文件也一并推给客户端。</p><p>本站在返回的请求中添加HTTP 标头实现HTTP2 server push。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(request.headers.get(<span class="string">&quot;content-type&quot;</span>)==<span class="string">&quot;text/html; charset=utf-8&quot;</span>)&#123;</span><br><span class="line">   response.headers.set(<span class="string">&quot;Link&quot;</span>, <span class="string">&quot;&lt;/css/style.css&gt;; rel=preload; as=style,&lt;/js/app.js&gt;; rel=preload; as=script, &lt;https://cdn.jsdelivr.net&gt;; rel=preconnect; crossorigin, &lt;https://cdn.jsdelivr.net&gt;; rel=dns-prefetch&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体实现可以查阅<a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.cloudflare.com/workers/examples/http2-server-push">相关文档</a></p><h3 id="CORS-header-proxy"><a href="#CORS-header-proxy" class="headerlink" title="CORS header proxy"></a>CORS header proxy</h3><p>由于██████████████████需要前端实现跨域，可以直接添加 HTTP 标头实现。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> corsHeaders = &#123;</span><br><span class="line">  <span class="string">&quot;Access-Control-Allow-Origin&quot;</span>: <span class="string">&quot;*&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Access-Control-Allow-Methods&quot;</span>: <span class="string">&quot;GET, HEAD, POST, OPTIONS&quot;</span>,</span><br><span class="line">  <span class="string">&quot;Access-Control-Allow-Headers&quot;</span>: <span class="string">&quot;Content-Type&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>具体实现可以查阅<a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.cloudflare.com/workers/examples/cors-header-proxy">相关文档</a></p><h2 id="其他应用"><a href="#其他应用" class="headerlink" title="其他应用"></a>其他应用</h2><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://developers.cloudflare.com/workers/examples">更多Examples</a></p><p>[文件已删除]</p><h3 id="搭建其他镜像站"><a href="#搭建其他镜像站" class="headerlink" title="搭建其他镜像站"></a>搭建其他镜像站</h3><p>上面介绍镜像自己的博客，如法炮制，你也可以镜像其他网站，例如Github、█████████、█████████、█████████等，请勿用于非法用途，否则后果自负。</p><p>下面是一个随便在百度中搜索到的脚本，几乎随便一搜都可以找到它，大家不会都用一个吧。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 你想镜像的站点</span></span><br><span class="line"><span class="keyword">const</span> upstream = <span class="string">&#x27;zh.wikipedia.org&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 针对移动端适配站点，没有就和保持和上面一致</span></span><br><span class="line"><span class="keyword">const</span> upstream_mobile = <span class="string">&#x27;zh.wikipedia.org&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 禁止某些地区访问</span></span><br><span class="line"><span class="keyword">const</span> blocked_region = []</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 禁止自访问</span></span><br><span class="line"><span class="keyword">const</span> blocked_ip_address = [<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 你想镜像的站点</span></span><br><span class="line"><span class="keyword">const</span> replace_dict = &#123;</span><br><span class="line">    <span class="string">&#x27;$upstream&#x27;</span>: <span class="string">&#x27;$custom_domain&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;//zh.wikipedia.org&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 剩下的就不用管了</span></span><br><span class="line">addEventListener(<span class="string">&#x27;fetch&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    event.respondWith(fetchAndApply(event.request));</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">fetchAndApply</span>(<span class="params">request</span>) </span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> region = request.headers.get(<span class="string">&#x27;cf-ipcountry&#x27;</span>).toUpperCase();</span><br><span class="line">    <span class="keyword">const</span> ip_address = request.headers.get(<span class="string">&#x27;cf-connecting-ip&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> user_agent = request.headers.get(<span class="string">&#x27;user-agent&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> response = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">let</span> url = <span class="keyword">new</span> URL(request.url);</span><br><span class="line">    <span class="keyword">let</span> url_host = url.host;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (url.protocol == <span class="string">&#x27;http:&#x27;</span>) &#123;</span><br><span class="line">        url.protocol = <span class="string">&#x27;https:&#x27;</span></span><br><span class="line">        response = Response.redirect(url.href);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">await</span> device_status(user_agent)) &#123;</span><br><span class="line">        upstream_domain = upstream</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        upstream_domain = upstream_mobile</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    url.host = upstream_domain;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (blocked_region.includes(region)) &#123;</span><br><span class="line">        response = <span class="keyword">new</span> Response(<span class="string">&#x27;Access denied: WorkersProxy is not available in your region yet.&#x27;</span>, &#123;</span><br><span class="line">            status: <span class="number">403</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(blocked_ip_address.includes(ip_address))&#123;</span><br><span class="line">        response = <span class="keyword">new</span> Response(<span class="string">&#x27;Access denied: Your IP address is blocked by WorkersProxy.&#x27;</span>, &#123;</span><br><span class="line">            status: <span class="number">403</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">let</span> method = request.method;</span><br><span class="line">        <span class="keyword">let</span> request_headers = request.headers;</span><br><span class="line">        <span class="keyword">let</span> new_request_headers = <span class="keyword">new</span> Headers(request_headers);</span><br><span class="line"> </span><br><span class="line">        new_request_headers.set(<span class="string">&#x27;Host&#x27;</span>, upstream_domain);</span><br><span class="line">        new_request_headers.set(<span class="string">&#x27;Referer&#x27;</span>, url.href);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">let</span> original_response = <span class="keyword">await</span> fetch(url.href, &#123;</span><br><span class="line">            method: method,</span><br><span class="line">            headers: new_request_headers</span><br><span class="line">        &#125;)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">let</span> original_response_clone = original_response.clone();</span><br><span class="line">        <span class="keyword">let</span> original_text = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">let</span> response_headers = original_response.headers;</span><br><span class="line">        <span class="keyword">let</span> new_response_headers = <span class="keyword">new</span> Headers(response_headers);</span><br><span class="line">        <span class="keyword">let</span> status = original_response.status;</span><br><span class="line"> </span><br><span class="line">        new_response_headers.set(<span class="string">&#x27;access-control-allow-origin&#x27;</span>, <span class="string">&#x27;*&#x27;</span>);</span><br><span class="line">        new_response_headers.set(<span class="string">&#x27;access-control-allow-credentials&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line">        new_response_headers.delete(<span class="string">&#x27;content-security-policy&#x27;</span>);</span><br><span class="line">        new_response_headers.delete(<span class="string">&#x27;content-security-policy-report-only&#x27;</span>);</span><br><span class="line">        new_response_headers.delete(<span class="string">&#x27;clear-site-data&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">const</span> content_type = new_response_headers.get(<span class="string">&#x27;content-type&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (content_type.includes(<span class="string">&#x27;text/html&#x27;</span>) &amp;&amp; content_type.includes(<span class="string">&#x27;UTF-8&#x27;</span>)) &#123;</span><br><span class="line">            original_text = <span class="keyword">await</span> replace_response_text(original_response_clone, upstream_domain, url_host);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            original_text = original_response_clone.body</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        response = <span class="keyword">new</span> Response(original_text, &#123;</span><br><span class="line">            status,</span><br><span class="line">            headers: new_response_headers</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">replace_response_text</span>(<span class="params">response, upstream_domain, host_name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> text = <span class="keyword">await</span> response.text()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> i, j;</span><br><span class="line">    <span class="keyword">for</span> (i <span class="keyword">in</span> replace_dict) &#123;</span><br><span class="line">        j = replace_dict[i]</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="string">&#x27;$upstream&#x27;</span>) &#123;</span><br><span class="line">            i = upstream_domain</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="string">&#x27;$custom_domain&#x27;</span>) &#123;</span><br><span class="line">            i = host_name</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> (j == <span class="string">&#x27;$upstream&#x27;</span>) &#123;</span><br><span class="line">            j = upstream_domain</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (j == <span class="string">&#x27;$custom_domain&#x27;</span>) &#123;</span><br><span class="line">            j = host_name</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">let</span> re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(i, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">        text = text.replace(re, j);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">device_status</span> (<span class="params">user_agent_info</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> agents = [<span class="string">&quot;Android&quot;</span>, <span class="string">&quot;iPhone&quot;</span>, <span class="string">&quot;SymbianOS&quot;</span>, <span class="string">&quot;Windows Phone&quot;</span>, <span class="string">&quot;iPad&quot;</span>, <span class="string">&quot;iPod&quot;</span>];</span><br><span class="line">    <span class="keyword">var</span> flag = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> v = <span class="number">0</span>; v &lt; agents.length; v++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (user_agent_info.indexOf(agents[v]) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Cloudflare-workers-blog"><a href="#Cloudflare-workers-blog" class="headerlink" title="Cloudflare workers blog"></a>Cloudflare workers blog</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/kasuganosoras/cloudflare-worker-blog">cloudflare-worker-blog</a></p><p>一个在Github上的开源实例，██████████████████████████████████████████████████<br>██████████████████████████████████Cloudflare workers + Github 实现的动态博客系统█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████。<br>。</p><h3 id="jsproxy"><a href="#jsproxy" class="headerlink" title="jsproxy"></a>jsproxy</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/EtherDream/jsproxy">jsproxy</a>一个基于浏览器端 JS 实现的在线代理，████████████████████████████████████████</p><p>█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████。</p><p>项目主要用于以下技术的研究：</p><ul><li>网站镜像 / 沙盒化</li><li>钓鱼网站检测技术</li><li>前端资源访问加速</li></ul><p>█████████████████████████████，否则█████████████。</p><h3 id="加速-Google-Analytics"><a href="#加速-Google-Analytics" class="headerlink" title="加速 Google Analytics"></a>加速 Google Analytics</h3><p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/SukkaW/cloudflare-workers-async-google-analytics">cloudflare-workers-async-google-analytics</a></p><p>The Cloudflare Workers implementation of an async Google Analytics.</p><p>██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████。</p><div class="note danger"><p>以上代码，请勿将其用于非法用途，否则后果自负。</p></div></div></details><div class="note radiation red"><p class="p center red">严禁未经授权的人员进行访问</p><p class="p center red">肇事者将被监控，定位并处理</p></div><div class="footer"><div class="copyright"><blockquote><p>博客内容遵循 署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</p><p>本文永久链接是：<a href="https://mhuig.github.io/posts/4a0f523a.html">https://mhuig.github.io/posts/4a0f523a.html</a></p></blockquote></div></div></div><div class="article-meta" id="bottom"><div class="new-meta-box"><div class="new-meta-item date" itemprop="dateUpdated" datetime="2020-08-31T19:53:40+08:00"><a class="notlink"><i class="fad fa-edit fa-fw" aria-hidden="true"></i><p>更新于：2020年8月31日</p></a></div><div class="new-meta-item browse valine"><a class="notlink"><i class="fad fa-eye fa-fw" aria-hidden="true"></i><span id="/posts/4a0f523a.html" class="leancloud_visitors" data-flag-title="初探 Cloudflare Workers 边缘计算"><p><span class="leancloud-visitors-count"></span></p></span></a></div><div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E8%BE%B9%E7%BC%98%E8%AE%A1%E7%AE%97/" rel="nofollow"><i class="fad fa-hashtag fa-fw" aria-hidden="true"></i><p>边缘计算</p></a></div></div></div><div class="prev-next"><a class="next" href="/posts/7b55143e.html"><p class="title">基于K均值聚类的网络流量异常检测(pyspark)<i class="fad fa-chevron-right" aria-hidden="true"></i></p><p class="content">异常检测常用于检测欺诈、网络攻击、服务器及传感设备故障。在这些应用中，我们要能够找出以前从未见过的新型异常，如新欺诈方式、新入侵方法或新服务器故障模式。 数据集KDD Cup 1999 数据...</p></a></div></article><article class="post white-box reveal shadow floatable blur" id="comments"><p ct><i class="fad fa-comments"></i> 评论</p><div id="minivaline_container"><i class="fad fa-cog fa-spin fa-fw fa-2x"></i></div></article></div><aside class="l_side"></aside></div><footer class="footer clearfix"><br><br><div class="aplayer-container"><meting-js theme="#1BCDFC" volume="0.7" loop="all" order="list" fixed="false" list-max-height="320px" server="netease" type="song" id="412785957" list-folded="true"></meting-js></div><br><div class="social-wrapper"><a href="/atom.xml" class="social fad fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="mailto:thepie@foxmail.com" class="social fad fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="https://github.com/MHuiG" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a><a href="https://music.163.com/#/user/home?id=63035382" class="social fad fa-headphones-alt flat-btn" target="_blank" rel="external nofollow noopener noreferrer"></a></div><div><p>博客内容遵循 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p></div><div class="copyright"><p><a href="https://icp.gov.moe" target="_blank" rel="external nofollow noopener noreferrer">萌ICP备</a> <a href="https://icp.gov.moe/?keyword=2020012138" target="_blank" rel="external nofollow noopener noreferrer">2020012138号</a><br><a href="https://mhuig.github.io/">Copyright © 2018-2020 MHuiG</a></p></div></footer><noscript><style type="text/css">#dialog{background-color:#fff;height:100%;width:100%;position:fixed!important;position:absolute;top:0;left:0;z-index:500;display:none}#dialog p{margin:0 auto;height:auto;line-height:124px;background:#ccc;color:red;font-size:60px}</style><div id="dialog" style="display:block"><div><p style="text-align:center"><b>本页面需要浏览器支持（启用）JavaScript<br><br>This page requires browser support (enabled) JavaScript</b></p></div></div></noscript><a class="s-top fad fa-arrow-up fa-fw" href="javascript:void(0)"></a></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script><script>function pjax_fancybox(){$(".md").find("img").not(".inline").not("a img").each(function(){var t=document.createElement("a");$(t).attr("class","fancybox"),$(t).attr("pjax-fancybox",""),$(t).attr("href",$(this).attr("src")),$(this).attr("data-original")&&$(t).attr("href",$(this).attr("data-original")),$(t).attr("data-fancybox","images");var a="";$(this).attr("alt")&&($(t).attr("data-caption",$(this).attr("alt")),a=$(this).attr("alt"));var e=document.createElement("div");$(e).addClass("fancybox"),$(this).wrap(e);var n=document.createElement("span");$(n).addClass("image-caption"),$(n).text(a),$(this).after(n);var i=document.createElement("div");$(i).addClass("bg"),$(this).attr("bg")&&$(i).css("background",$(this).attr("bg")),$(this).wrap(i),$(this).wrap(t)}),$(".article-entry").find("img").fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1,closeClick:!0,helpers:{overlay:{closeClick:!0}},buttons:["zoom","close"]})}function SCload_fancybox(){loadCSS("https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css",document.getElementById("loadcss")),setTimeout(function(){var t=document.getElementsByTagName("head")[0]||document.documentElement,a=document.createElement("script");a.setAttribute("type","text/javascript"),a.onload=function(){pjax_fancybox()},a.setAttribute("src","https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"),t.appendChild(a)},1)}$(function(){$(".md").find("img").not(".inline").not("a img").length+$(".article-entry").find("img").length!=0&&SCload_fancybox()});</script><script type="text/javascript">$(function(){for(var t=[],e=1;e<=40;e++)t.push("https://cdn.jsdelivr.net/npm/mhg@0.0.0/cov/1%20("+e+").webp");!function(t){for(var e=t.length;e--;){var c=Math.floor(Math.random()*e),r=t[c];t[c]=t[e],t[e]=r}}(t),loadScript("https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js",function(){setTimeout(function(){$(".cover-backstretch").backstretch(t,{duration:"10000",fade:"1500"}),"none"==document.getElementsByClassName("cover-wrapper")[0].style.display?$(".cover-backstretch").backstretch("pause"):$(".cover-backstretch").backstretch("next")},1e4)})});</script><script defer="defer" src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.1.0/dist/lazyload.min.js"></script><script>window.lazyLoadOptions={elements_selector:".lazyload",threshold:0},window.addEventListener("LazyLoad::Initialized",function(n){window.lazyLoadInstance=n.detail.instance},!1),document.addEventListener("DOMContentLoaded",function(){lazyLoadInstance.update()}),document.addEventListener("pjax:complete",function(){lazyLoadInstance.update()});</script><script>window.FPConfig={delay:0,ignoreKeywords:["#"],maxRPS:6,hoverDelay:0};</script><script defer="defer" src="https://cdn.jsdelivr.net/npm/mhg@0.0.1/js/flying-pages.min.js"></script><script>var APlayerController=new Object;APlayerController.id="412785957",APlayerController.volume="0.7",loadScript("https://cdn.jsdelivr.net/npm/mhg@0.0.0/js/APlayer.mini.js"),loadScript("https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js");</script><script>var load_minivaline,pjax_minivaline;"localhost"!=window.location.hostname&&(load_minivaline=function(){setTimeout(function(){var e=document.getElementsByTagName("head")[0]||document.documentElement,n=document.createElement("script");n.setAttribute("type","text/javascript"),n.onload=function(){pjax_minivaline()},n.setAttribute("src","https://cdn.jsdelivr.net/npm/minivaline@4.1.1/dist/MiniValine.min.js"),e.appendChild(n)},1)},pjax_minivaline=function(){var e,n;document.querySelectorAll("#minivaline_container")[0]&&(e=$.trim($("#pjax-comment-placeholder").text())||"快来评论吧~",0==(n=$.trim($("#pjax-comment-path").text())).length&&(n=decodeURI(window.location.pathname)),new MiniValine({el:"#minivaline_container",appId:"233",appKey:"23333",mode:"xCss",placeholder:e,path:n,math:!0,md:!0,enableQQ:!1,NoRecordIP:!1,visitor:!0,maxNest:6,pageSize:6,barrager:0,closeFlag:!1,cloudflag:!0,closeUA:!1,serverURLs:"https://mv.mhuig.top",vc:"Vt",region:"true"}))},$(function(){document.querySelectorAll("#minivaline_container")[0]&&load_minivaline()}));</script><script type="text/javascript">function getClientHeight(){return document.body.clientHeight&&document.documentElement.clientHeight?document.body.clientHeight<document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight:document.body.clientHeight>document.documentElement.clientHeight?document.body.clientHeight:document.documentElement.clientHeight}function supportCss3(e){function t(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})}var o,n=["webkit","Moz","ms","o"],d=[],r=document.documentElement.style;for(o in n)d.push(t(n[o]+"-"+e));for(o in d.push(t(e)),d)if(d[o]in r)return!0;return!1}var options={bottom:"32px",right:"unset",left:"16px",time:"0s",mixColor:"skyblue",backgroundColor:"skyblue",buttonColorDark:"#333",buttonColorLight:"#ddd",saveInCookies:!0,label:"",autoMatchOsTheme:!0};function pjax_darkmodejs(){var e;supportCss3("mix-blend-mode")&&(e=setInterval(function(){var t;"undefined"!=typeof jQuery&&(clearInterval(e),t=getClientHeight(),$(window).scroll(function(){var e=$(document).scrollTop();t<e?($(".darkmode-layer").css("mix-blend-mode","normal"),$(".darkmode-layer").css("background-color","#21232F")):($(".darkmode-layer").css("mix-blend-mode","difference"),$(".darkmode-layer").css("background-color",""))}))},100))}function loaddarkmodejs(){supportCss3("mix-blend-mode")&&(window.darkmode=new Darkmode(options),pjax_darkmodejs())}loadScript("https://cdn.jsdelivr.net/npm/darkmode-js@1.5/lib/darkmode-js.min.js",loaddarkmodejs);</script><script src="https://cdn.jsdelivr.net/npm/mhg@0.0.8/js/app.js"></script><script>var SEARCH_SERVICE="hexo",ROOT="/";function setSearchService(){customSearch=new HexoSearch({})}ROOT.endsWith("/")||(ROOT+="/"),$(".input.u-search-input").one("focus",function(){var e=document.getElementsByTagName("head")[0]||document.documentElement,t=document.createElement("script");t.setAttribute("type","text/javascript"),t.onload=function(){setSearchService()},t.setAttribute("src","https://cdn.jsdelivr.net/npm/mhg@0.0.6/js/search.js"),e.appendChild(t)});</script><script>function loadloadcss(){loadCSS("https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css",document.getElementById("loadcss"))}loadScript("https://cdn.jsdelivr.net/npm/fg-loadcss@3.1.0/dist/loadCSS.min.js",loadloadcss);</script><script>var TimeInterval,now=new Date;function SiteTime(){try{var n=new Date("08/19/2019 21:23:12");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("timeDate").innerHTML="本站已安全运行 "+dnum+" 天 ",document.getElementById("times").innerHTML=hnum+" 小时 "+mnum+" 分 "+snum+" 秒"}catch(n){}}"undefined"==typeof SiteTimeFlag&&(TimeInterval=setInterval("SiteTime()",250),window.SiteTimeFlag=!0);</script><script>loadScript("https://cdn.jsdelivr.net/npm/mhg@0.0.8/js/ip.min.js");</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><div class="pjax-animate"><script aysc src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script><div id="loading-bar-wrapper"><script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed:100});</script></div><script>window.ShowLoading=function(){NProgress.start()},window.HideLoading=function(){NProgress.done()};</script></div><script>var pjax;document.addEventListener("DOMContentLoaded",function(){pjax=new Pjax({elements:'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',selectors:["title","#pjax-container","#pjax-header-nav-list"],cacheBust:!1,timeout:5e3})}),document.addEventListener("pjax:send",function(e){try{var n=window.location.pathname,a=e.triggerElement.href,o=["/time-machine/index.html","/time-machine/"];""!=o[0]&&o.forEach(function(e){-1==n.indexOf(e)&&-1==a.indexOf(e)||(window.location.href=a)}),"localhost:4000"!=window.location.host&&window.location.origin&&window.BlogPageFastURL&&window.location.origin!=window.BlogPageFastURL&&(window.location.href=e.triggerElement.href.replace(window.location.origin,window.BlogPageFastURL))}catch(e){}window.subData=null,$.fancybox.close(),$(".l_header .switcher .s-search").removeClass("active"),$(".l_header").removeClass("z_search-open"),$(".wrapper").removeClass("sub"),$(".s-top").unbind("click"),$(".menu a").unbind("click"),$(window).unbind("resize"),$(window).unbind("scroll"),$(document).unbind("scroll"),$(document).unbind("click"),$("body").unbind("click"),window.ShowLoading()}),document.addEventListener("pjax:complete",function(){_hmt.push(["_trackPageview",document.location.pathname]),window.dataLayer=window.dataLayer||[],function(){dataLayer.push(arguments)}("config","UA-148909894-1",{page_path:document.location.pathname}),$(".nav-main").find(".list-v").not(".menu-phone").removeAttr("style",""),$(".menu-phone.list-v").removeAttr("style",""),$("script[data-pjax], .pjax-reload script").each(function(){$(this).parent().append($(this).remove())});try{(void 0===$.fancybox?SCload_fancybox:pjax_fancybox)(),$(".cover-backstretch").backstretch("resize"),("undefined"==typeof MiniValine?load_minivaline:pjax_minivaline)(),pjax_darkmodejs(),"none"==document.getElementsByClassName("cover-wrapper")[0].style.display?$(".cover-backstretch").backstretch("pause"):$(".cover-backstretch").backstretch("next")}catch(e){console.log(e)}window.HideLoading()}),document.addEventListener("pjax:error",function(e){window.HideLoading(),window.location.href=e.triggerElement.href});</script></div><script>"serviceWorker"in navigator&&navigator.serviceWorker.register("/s.js").then(function(r){r.onupdatefound=function(){var e=r.installing;e.onstatechange=function(){switch(e.state){case"installed":navigator.serviceWorker.controller?console.log("Updated serviceWorker."):console.log("serviceWorker Sucess!");break;case"redundant":console.error("The installing service worker became redundant.")}}}}).catch(function(e){console.error("Error during service worker registration:",e)});</script></body></html>